meta {
  name: 7_Delete_a_comment
  type: http
  seq: 7
}

delete {
  url: {{url}}/{{comment_path_root}}/{{commentId}}
  body: none
  auth: inherit
}

script:pre-request {
  // --- Showcase Strategy: Idempotency & Safety ---
  
  // 1. Self-Healing
  let targetId = bru.getVar("commentId");

  if (!targetId) {
    // Si lancé isolément, on supprime l'ID 1 (sans effet réel sur le mock)
    bru.setVar("commentId", 1);
    console.warn("[Showcase Warning] No commentId to delete. Defaulting to ID 1.");
  } else {
    console.log(`[Showcase Info] Deleting Comment ID: ${targetId}`);
  }
}

tests {
  // 1. Validation de Statut
  test("Status code is 200 OK", function() {
    expect(res.getStatus()).to.equal(200);
  });

  // 2. Validation de réponse vide
  test("Response body is empty", function() {
    expect(res.getBody()).to.be.an('object');
    expect(Object.keys(res.getBody()).length).to.equal(0);
  });

  // 3. Performance
  test("Deletion took less than 1s", function() {
    expect(res.getResponseTime()).to.be.below(1000);
  });
}