meta {
  name: 7_Delete_an_album
  type: http
  seq: 7
}

delete {
  url: {{url}}/{{albums_path_root}}/{{albumId}}
  body: none
  auth: inherit
}

script:pre-request {
  // --- Showcase Strategy: Safety & Idempotency ---
  
  // 1. Correction de l'URL cible
  // On s'assure qu'on tape bien sur /albums/ID et pas sur /users/ID
  // (L'erreur √©tait dans l'URL du script original)

  // 2. Self-Healing
  let targetId = bru.getVar("albumId");

  if (!targetId) {
    // Si pas d'ID (test isol√©), on simule sur l'ID 1
    // JSONPlaceholder ne supprime rien vraiment, c'est sans danger.
    bru.setVar("albumId", 1);
    console.warn("[Showcase Warning] No albumId to delete. Defaulting to ID 1.");
  } else {
    console.log(`[Showcase Info] Deleting Album ID: ${targetId}`);
  }
}

tests {
  // 1. Validation de Statut
  test("Status code is 200 OK", function() {
    // JSONPlaceholder renvoie 200 (d'autres API renvoient 204 No Content)
    expect(res.getStatus()).to.equal(200);
  });

  // 2. Validation de confirmation
  test("Response body is empty", function() {
    // Une suppression r√©ussie renvoie un objet vide {}
    expect(res.getBody()).to.be.an('object');
    expect(Object.keys(res.getBody()).length).to.equal(0);
  });

  // 3. Performance
  test("Deletion took less than 1s", function() {
    expect(res.getResponseTime()).to.be.below(1000);
  });
}

docs {
  # üóëÔ∏è Scenario: Digital Asset Removal (Cleanup)

  This request concludes the Album lifecycle workflow by simulating the **Decommissioning** of a technical document/asset.

  ## üßπ Technical Goal: Environment Hygiene
  In a professional CI/CD pipeline, "cleaning up after yourself" is critical to prevent:
  * **State Leakage**: Ensuring subsequent test runs start with a clean slate.
  * **Database Bloat**: Removing temporary test data generated during execution.

  ## üõ°Ô∏è Robustness & Safety
  The `pre-request` script implements a **Safe Failover** strategy to prevent pipeline brittleness:
  * **Context Check**: It attempts to retrieve the `albumId` used in previous steps.
  * **Fallback**: If the test runs in isolation (variable undefined), it defaults to `ID: 1`. This ensures the cleanup step never causes a "Red Build" due to a missing variable, which is a common CI/CD anti-pattern.

  ## ‚úÖ Quality Gates
  * **Status**: 200 OK.
  * **REST Compliance**: Validates that the API acknowledges the deletion by returning an **Empty JSON Object** `{}`, confirming the resource has been purged.
  * **Performance**: Strict SLA (< 1000ms).
}