meta {
  name: 3_Get_a_post_by_ID
  type: http
  seq: 3
}

get {
  url: {{url}}/{{post_path_root}}/{{postId}}
  body: none
  auth: inherit
}

script:pre-request {
  // --- Showcase Strategy: Handling Mock API Constraints ---
  
  // RAPPEL : JSONPlaceholder ne persiste pas les cr√©ations.
  // L'ID 'newPostId' (ex: 101) cr√©√© √† l'√©tape pr√©c√©dente n'existe pas vraiment serveur c√¥t√©.
  // Faire un GET dessus renverrait une 404.
  
  // Pour valider que la lecture fonctionne, on utilise un ID R√âEL r√©cup√©r√© √† l'√©tape 1.
  let targetId = bru.getVar("existingPostId");

  // --- Self-Healing ---
  // Si l'√©tape 1 n'a pas tourn√© (test isol√©), on prend l'ID 1 par d√©faut.
  if (!targetId) {
    targetId = 1;
    console.log("[Showcase Info] No existingPostId found. Defaulting to ID 1.");
  } else {
    console.log(`[Showcase Info] Fetching real post with ID: ${targetId}`);
  }

  // On injecte cet ID valide dans la variable {{postId}} de l'URL
  bru.setVar("postId", targetId);
}

tests {
  // 1. Validation de succ√®s
  test("Status code is 200 OK", function() {
    expect(res.getStatus()).to.equal(200);
  });

  // 2. Validation de coh√©rence
  test("Returned ID matches requested ID", function() {
    const requestedId = parseInt(bru.getVar("postId"));
    expect(res.getBody().id).to.equal(requestedId);
  });

  // 3. Validation de structure (Schema Check)
  test("Post has valid fields", function() {
    const post = res.getBody();
    expect(post).to.have.property('title').that.is.a('string');
    expect(post).to.have.property('body').that.is.a('string');
    expect(post).to.have.property('userId').that.is.a('number');
  });

  // 4. Performance
  test("Response time < 500ms", function() {
    expect(res.getResponseTime()).to.be.below(500);
  });
}

docs {
  # üß™ Scenario: Post Retrieval & Environment Adaptation

  This request validates the ability to fetch a specific blog post by its unique identifier.

  ## üß† Technical Highlight: The "Mock Paradox"
  In a real-world scenario, we would verify the Post created in the previous step. However, **JsonPlaceholder** is a stateless mock API (creates are not persisted).
  * **Problem**: Fetching the ID returned by the `POST` request (e.g., `101`) results in a `404 Not Found`.
  * **Solution**: The `pre-request` script intelligently pivots to `existingPostId` (a known valid ID captured in Step 1).

  ## üõ°Ô∏è Robustness Strategy
  * **Self-Healing**: The script checks if a valid target ID is available in the runtime variables. If running in isolation (variable undefined), it automatically defaults to `ID: 1` to ensure the test passes.

  ## ‚úÖ Quality Gates
  * **Status**: 200 OK.
  * **Data Consistency**: Ensures the API returns the exact resource requested (`requested_id === returned_id`).
  * **Schema Validation**: Strictly checks types (`title` is string, `userId` is number).
  * **Performance**: Strict SLA (< 500ms).
}