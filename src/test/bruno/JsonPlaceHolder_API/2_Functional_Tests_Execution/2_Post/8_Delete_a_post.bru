meta {
  name: 8_Delete_a_post
  type: http
  seq: 8
}

delete {
  url: {{url}}/{{post_path_root}}/{{postId}}
  body: none
  auth: inherit
}

script:pre-request {
  // --- Showcase Strategy: Safe Cleanup ---
  
  // 1. Self-Healing
  let targetId = bru.getVar("postId");

  if (!targetId) {
    // Si lanc√© isol√©ment, on cible le post 1 (safe sur un mock)
    bru.setVar("postId", 1);
    console.warn("[Showcase Warning] No postId to delete. Defaulting to ID 1.");
  } else {
    console.log(`[Showcase Info] Deleting Post ID: ${targetId}`);
  }
}

tests {
  // 1. Validation de Statut
  test("Status code is 200 OK", function() {
    expect(res.getStatus()).to.equal(200);
  });

  // 2. Validation de r√©ponse vide
  test("Response body is empty", function() {
    // Standard REST : un delete r√©ussi renvoie souvent un objet vide
    expect(res.getBody()).to.be.an('object');
    expect(Object.keys(res.getBody()).length).to.equal(0);
  });

  // 3. Performance
  test("Deletion took less than 1s", function() {
    expect(res.getResponseTime()).to.be.below(1000);
  });
}

docs {
  # üóëÔ∏è Scenario: Content Removal (Cleanup)

  This request concludes the Blog Post lifecycle by removing the created resource.

  ## üßπ Technical Goal: Environment Hygiene
  In automated testing, ensuring data cleanup is crucial to prevent "state leakage" between test runs, which can lead to false positives or database bloat.

  ## üõ°Ô∏è Robustness Strategy
  The `pre-request` script implements a **Safe Failover** mechanism:
  * **Context Check**: It attempts to retrieve the `postId` manipulated in previous steps.
  * **Fallback**: If the test is executed in isolation (no ID in memory), it defaults to `ID: 1`. This ensures the HTTP call completes successfully without breaking the pipeline, while acknowledging the limitations of the Mock API (which doesn't actually delete the persistent data).

  ## ‚úÖ Quality Gates
  * **Status**: 200 OK.
  * **Standard REST Compliance**: Validates that the server acknowledges the deletion by returning an **Empty JSON Object** `{}`, confirming the operation was processed.
  * **Performance**: Strict SLA (< 1000ms).
}